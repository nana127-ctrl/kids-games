<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾¦æ¢ç¬”è®° - å„¿ç«¥æ¨ç†æŒ‘æˆ˜</title>
    <!-- å¼•å…¥å¤–éƒ¨èµ„æº -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰æ ·å¼ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        detective: {
                            brown: '#8B4513',      // ç‰›çš®çº¸æ£•è‰²
                            sepia: '#E8C69E',     // å¤å¤è¤è‰²
                            ink: '#2C1E1E',       // å¢¨æ°´è‰²
                            accent: '#A62639',    // å¼ºè°ƒè‰²ï¼ˆçº¢è‰²å°ç« ï¼‰
                            yellow: '#F9E076',    // ä¾¿ç­¾é»„è‰²
                            tape: '#FFFFFF80',    // èƒ¶å¸¦è‰²
                        }
                    },
                    fontFamily: {
                        detective: ['"Courier New"', '"Comic Sans MS"', 'serif']
                    }
                }
            }
        }
    </script>
    
    <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .paper-texture {
                background-image: url('https://picsum.photos/id/106/1000/1000');
                background-size: cover;
                background-blend-mode: overlay;
            }
            .map-texture {
                background-image: url('https://picsum.photos/id/101/1000/1000');
                background-size: cover;
                background-blend-mode: overlay;
                opacity: 0.1;
            }
            .notebook-line {
                background-image: linear-gradient(#2C1E1E10 1px, transparent 1px);
                background-size: 100% 1.75rem;
            }
            .stamp {
                transform: rotate(-10deg);
                opacity: 0.8;
            }
            .tape {
                position: relative;
            }
            .tape::before {
                content: "";
                position: absolute;
                width: 60px;
                height: 20px;
                background-color: theme('colors.detective.tape');
                transform: rotate(-15deg);
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }
            .tape-top-left::before {
                top: -10px;
                left: 10px;
            }
            .tape-top-right::before {
                top: -10px;
                right: 10px;
                transform: rotate(15deg);
            }
            .handwritten {
                text-shadow: 1px 1px 0px rgba(0,0,0,0.05);
            }
            .magnify-hover {
                transition: transform 0.3s ease;
            }
            .magnify-hover:hover {
                transform: scale(1.05);
            }
            .clue-appear {
                animation: clueAppear 0.5s ease forwards;
            }
            @keyframes clueAppear {
                from { opacity: 0; transform: translateX(-20px); }
                to { opacity: 1; transform: translateX(0); }
            }
            .correct-animation {
                animation: correct 0.5s ease;
            }
            @keyframes correct {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }
            .wrong-animation {
                animation: wrong 0.5s ease;
            }
            @keyframes wrong {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
            .page-curl {
                position: relative;
            }
            .page-curl::after {
                content: "";
                position: absolute;
                bottom: 0;
                right: 0;
                width: 30px;
                height: 30px;
                background: linear-gradient(135deg, transparent 50%, rgba(0,0,0,0.05) 50%);
                border-radius: 0 0 0 5px;
            }
        }
    </style>
</head>
<body class="bg-detective-sepia paper-texture min-h-screen font-detective text-detective-ink overflow-x-hidden">
    <!-- åœ°å›¾çº¹ç†è£…é¥°å±‚ -->
    <div class="fixed inset-0 map-texture pointer-events-none z-0"></div>

    <div class="container mx-auto px-4 py-8 relative z-10">
        <!-- æ ‡é¢˜åŒºåŸŸ - ä¾¦æ¢ç¬”è®°é£æ ¼ -->
        <div class="text-center mb-8 relative tape tape-top-left">
            <div class="absolute -top-4 -left-4 md:-left-10 text-4xl md:text-6xl text-detective-brown/30 rotate-12">ğŸ”</div>
            <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-detective-brown relative inline-block handwritten">
                ä¾¦æ¢ç¬”è®°
                <div class="absolute -bottom-2 left-0 w-full h-1 bg-detective-brown/50"></div>
            </h1>
            <p class="text-[clamp(1rem,2vw,1.25rem)] text-detective-ink/80 mt-4 italic">å„¿ç«¥æ¨ç†æŒ‘æˆ˜æ¡ˆä»¶ç°¿</p>
            <div class="absolute -top-4 -right-4 md:-right-10 text-4xl md:text-6xl text-detective-brown/30 -rotate-12">ğŸ“</div>
        </div>

        <!-- é¡µé¢å®¹å™¨ - ç¬”è®°æœ¬é£æ ¼ -->
        <div class="max-w-5xl mx-auto bg-detective-sepia/90 rounded-lg shadow-2xl border-2 border-detective-brown/30 overflow-hidden relative page-curl">
            <!-- ç¬”è®°æœ¬è£…è®¢çº¿è£…é¥° -->
            <div class="absolute left-0 top-0 bottom-0 w-4 md:w-6 bg-detective-brown/20 flex flex-col justify-between">
                <div class="flex-1"></div>
                <div class="w-full h-full flex flex-col justify-around py-4">
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                </div>
                <div class="flex-1"></div>
            </div>

            <!-- å†…å®¹åŒºåŸŸ - å‘å³åç§»ä»¥é¿å¼€è£…è®¢çº¿ -->
            <div class="ml-4 md:ml-6 p-4 md:p-8">
                <!-- 1. é¦–é¡µ/ä¸Šä¼ é¡µé¢ -->
                <div id="upload-page" class="transition-all duration-500 relative">
                    <!-- è£…é¥°æ€§ä¾¦æ¢å…ƒç´  -->
                    <div class="absolute top-4 right-4 text-3xl opacity-20 transform rotate-12">ğŸ”</div>
                    
                    <div class="text-center mb-8 tape tape-top-right">
                        <div class="inline-block p-4 bg-detective-yellow rounded-lg shadow-md mb-4 transform -rotate-2">
                            <i class="fa fa-search text-4xl text-detective-ink"></i>
                        </div>
                        <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-detective-brown transform rotate-1 handwritten">æ¡ˆä»¶å‡†å¤‡</h2>
                        <p class="text-detective-ink/70 mt-2 italic">é€‰æ‹©ä½ çš„æ¡ˆä»¶æ¡£æ¡ˆï¼Œå¼€å§‹è°ƒæŸ¥ï¼</p>
                    </div>

                    <div class="space-y-8">
                        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ - ä¾¦æ¢æ¡£æ¡ˆè¢‹é£æ ¼ -->
                        <div class="border-2 border-detective-brown/40 rounded-lg p-6 md:p-8 bg-detective-sepia notebook-line shadow-md relative magnify-hover">
                            <div class="absolute top-2 right-2 text-xl opacity-30">ğŸ“‚</div>
                            <label for="file-upload" class="cursor-pointer">
                                <div class="mb-4 text-center">
                                    <i class="fa fa-folder-open text-5xl text-detective-brown/70"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-detective-brown mb-3 text-center handwritten">ä¸Šä¼ æ¡ˆä»¶æ¡£æ¡ˆ</h3>
                                <p class="text-detective-ink/70 mb-4 text-center">æ”¯æŒExcelæ ¼å¼çš„çº¿ç´¢æ–‡ä»¶ (.xlsx, .xls)</p>
                                <div class="text-center">
                                    <span class="inline-block px-4 py-2 bg-detective-brown/10 border border-detective-brown/30 rounded text-detective-brown cursor-pointer hover:bg-detective-brown/20 transition-colors">
                                        <i class="fa fa-upload mr-1"></i> é€‰æ‹©æ–‡ä»¶
                                    </span>
                                </div>
                                <input id="file-upload" type="file" accept=".xlsx, .xls" class="hidden" />
                            </label>
                            <div id="file-name" class="mt-4 text-detective-accent text-center hidden"></div>
                        </div>

                        <!-- å¿«æ·å¼€å§‹æŒ‰é’® -->
                        <div class="bg-detective-yellow/40 p-4 rounded-lg notebook-line shadow-sm">
                            <p class="text-center text-detective-ink/80 mb-3">æ²¡æœ‰æ¡ˆä»¶æ¡£æ¡ˆï¼Ÿç›´æ¥å¼€å§‹é¢„è®¾æ¡ˆä»¶ï¼</p>
                            <div class="flex justify-center">
                                <button id="start-game" class="px-8 py-3 bg-detective-brown text-white font-bold rounded shadow-md hover:bg-brown-800 transition-all transform hover:-rotate-1 active:rotate-1">
                                    <i class="fa fa-play mr-2"></i>å¼€å§‹è°ƒæŸ¥
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- è£…é¥°æ€§å…ƒç´  - ä¾¦æ¢ç¬”è®°æ¶‚é¸¦ -->
                    <div class="mt-6 text-right opacity-20">
                        <i class="fa fa-pencil-square-o text-4xl"></i>
                    </div>
                </div>

                <!-- 2. æ¸¸æˆç•Œé¢ -->
                <div id="game-page" class="hidden transition-all duration-500">
                    <!-- è£…é¥°æ€§å…ƒç´  -->
                    <div class="absolute top-4 right-4 text-2xl opacity-20">ğŸ“‹</div>
                    
                    <!-- è¿›åº¦æŒ‡ç¤º - æ¡ˆä»¶è¿›åº¦ -->
                    <div class="mb-8 relative p-3 bg-detective-yellow/30 rounded shadow-sm notebook-line">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-detective-ink font-semibold flex items-center">
                                <i class="fa fa-list-ol mr-2"></i>æ¡ˆä»¶è¿›åº¦
                            </span>
                            <span id="progress-text" class="text-detective-brown font-bold bg-white/50 px-2 py-0.5 rounded"></span>
                        </div>
                        <div class="h-2 bg-white/70 rounded-full overflow-hidden border border-detective-brown/30">
                            <div id="progress-bar" class="h-full bg-detective-accent rounded-full transition-all duration-500" style="width: 25%"></div>
                        </div>
                    </div>

                    <!-- é¡¶éƒ¨é€‰é¡¹åŒºåŸŸ - å«Œç–‘äºº/çº¿ç´¢é€‰æ‹© -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-detective-brown mb-4 pl-2 border-l-4 border-detective-brown/50 handwritten">
                            <i class="fa fa-users mr-2"></i>è°ƒæŸ¥å¯¹è±¡
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="option-card bg-white/60 rounded-lg p-3 cursor-pointer border-2 border-transparent hover:border-detective-brown shadow-md magnify-hover" data-index="0">
                                <div class="option-image h-28 md:h-36 flex items-center justify-center text-5xl md:text-7xl mb-2">
                                    <span id="option-0-img"></span>
                                </div>
                                <div class="option-text text-center font-medium text-detective-ink text-sm md:text-base" id="option-0-text"></div>
                            </div>
                            <div class="option-card bg-white/60 rounded-lg p-3 cursor-pointer border-2 border-transparent hover:border-detective-brown shadow-md magnify-hover" data-index="1">
                                <div class="option-image h-28 md:h-36 flex items-center justify-center text-5xl md:text-7xl mb-2">
                                    <span id="option-1-img"></span>
                                </div>
                                <div class="option-text text-center font-medium text-detective-ink text-sm md:text-base" id="option-1-text"></div>
                            </div>
                            <div class="option-card bg-white/60 rounded-lg p-3 cursor-pointer border-2 border-transparent hover:border-detective-brown shadow-md magnify-hover" data-index="2">
                                <div class="option-image h-28 md:h-36 flex items-center justify-center text-5xl md:text-7xl mb-2">
                                    <span id="option-2-img"></span>
                                </div>
                                <div class="option-text text-center font-medium text-detective-ink text-sm md:text-base" id="option-2-text"></div>
                            </div>
                            <div class="option-card bg-white/60 rounded-lg p-3 cursor-pointer border-2 border-transparent hover:border-detective-brown shadow-md magnify-hover" data-index="3">
                                <div class="option-image h-28 md:h-36 flex items-center justify-center text-5xl md:text-7xl mb-2">
                                    <span id="option-3-img"></span>
                                </div>
                                <div class="option-text text-center font-medium text-detective-ink text-sm md:text-base" id="option-3-text"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸­å¤®çº¿ç´¢åŒºåŸŸ - ç¬”è®°é£æ ¼ -->
                    <div class="bg-white/70 rounded-lg p-5 md:p-7 mb-8 shadow-md relative notebook-line border border-detective-brown/20 tape tape-top-left">
                        <!-- çº¢è‰²å°ç« è£…é¥° -->
                        <div class="absolute top-2 right-2 text-5xl text-detective-accent/20 stamp">
                            <i class="fa fa-gavel"></i>
                        </div>
                        
                        <h3 class="text-xl font-bold text-detective-brown mb-6 flex items-center relative handwritten">
                            <i class="fa fa-file-text-o mr-2"></i>æ¡ˆä»¶çº¿ç´¢ç¬”è®°
                            <div class="absolute -bottom-2 left-0 w-full h-0.5 bg-detective-brown/30"></div>
                        </h3>
                        
                        <div class="space-y-4 mt-6 pl-2">
                            <div class="clue-item clue-appear flex items-start" style="animation-delay: 0.1s">
                                <div class="bg-detective-brown text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 flex-shrink-0 mt-0.5 text-sm">1</div>
                                <p class="text-detective-ink" id="clue-0"></p>
                            </div>
                            <div class="clue-item clue-appear flex items-start" style="animation-delay: 0.2s">
                                <div class="bg-detective-brown text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 flex-shrink-0 mt-0.5 text-sm">2</div>
                                <p class="text-detective-ink" id="clue-1"></p>
                            </div>
                            <div class="clue-item clue-appear flex items-start" style="animation-delay: 0.3s">
                                <div class="bg-detective-brown text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 flex-shrink-0 mt-0.5 text-sm">3</div>
                                <p class="text-detective-ink" id="clue-2"></p>
                            </div>
                            <div class="clue-item clue-appear flex items-start" style="animation-delay: 0.4s">
                                <div class="bg-detective-brown text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 flex-shrink-0 mt-0.5 text-sm">4</div>
                                <p class="text-detective-ink" id="clue-3"></p>
                            </div>
                        </div>
                    </div>

                    <!-- åº•éƒ¨äº¤äº’åŒºåŸŸ -->
                    <div class="flex justify-center">
                        <button id="next-question" class="px-8 py-3 bg-detective-accent text-white font-bold rounded shadow-md hover:bg-red-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed transform hover:rotate-1 active:-rotate-1">
                            <i class="fa fa-arrow-right mr-2"></i>ä¸‹ä¸€ä¸ªæ¡ˆä»¶
                        </button>
                    </div>

                    <!-- åé¦ˆä¿¡æ¯ -->
                    <div id="feedback" class="mt-6 text-center hidden">
                        <p id="feedback-text" class="text-xl font-bold handwritten"></p>
                    </div>
                </div>

                <!-- 3. ç»“ç®—é¡µé¢ -->
                <div id="result-page" class="hidden transition-all duration-500 text-center">
                    <!-- è£…é¥°å°ç«  -->
                    <div class="text-8xl text-detective-accent/20 absolute top-10 right-10 stamp">
                        <i class="fa fa-trophy"></i>
                    </div>
                    
                    <div class="mb-8 relative tape tape-top-left">
                        <div class="inline-block p-5 bg-detective-yellow rounded-lg shadow-md mb-6 transform rotate-2">
                            <i class="fa fa-certificate text-5xl text-detective-ink"></i>
                        </div>
                        <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-detective-brown mb-4 transform -rotate-1 handwritten">ç ´æ¡ˆæˆåŠŸï¼</h2>
                        <p class="text-detective-ink/80 text-lg max-w-2xl mx-auto italic notebook-line p-4 bg-white/50 rounded">
                            æ­å–œä½ æˆåŠŸç ´è§£äº†æ‰€æœ‰æ¡ˆä»¶ï¼ä½ çš„ä¾¦æ¢æŠ€èƒ½éå¸¸å‡ºè‰²ï¼Œ
                            é€»è¾‘æ€ç»´å’Œè§‚å¯ŸåŠ›éƒ½è¾¾åˆ°äº†é¡¶çº§ä¾¦æ¢çš„æ°´å¹³ï¼
                        </p>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                        <button id="play-again" class="px-6 py-3 bg-detective-brown text-white font-bold rounded shadow-md hover:bg-brown-800 transition-all transform hover:-rotate-1 active:rotate-1">
                            <i class="fa fa-refresh mr-2"></i>å†ç ´ä¸€æ¡ˆ
                        </button>
                        <button id="back-home" class="px-6 py-3 bg-detective-yellow text-detective-ink font-bold rounded shadow-md hover:bg-yellow-300 transition-all transform hover:rotate-1 active:-rotate-1">
                            <i class="fa fa-home mr-2"></i>è¿”å›æ¡£æ¡ˆåº“
                        </button>
                    </div>

                    <!-- è£…é¥°æ€§ç­¾åå’Œè´´çº¸ -->
                    <div class="mt-10 text-right text-detective-brown/70 italic">
                        <p>â€”â€” å°‘å¹´ä¾¦æ¢ç¤¾</p>
                    </div>
                    <div class="absolute bottom-6 left-6 text-4xl opacity-20 transform -rotate-15">
                        <i class="fa fa-star"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ­£ç¡®åé¦ˆè¯­éŸ³ -->
    <audio id="correct-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-kid-voice-saying-yes-2855.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
    </audio>

    <!-- é¡µè„š -->
    <footer class="mt-12 py-6 text-center text-detective-ink/60 text-sm relative z-10">
        <p>ä¾¦æ¢ç¬”è®° &copy; 2023 - å„¿ç«¥æ¨ç†è®­ç»ƒæ¡ˆä»¶é›†</p>
    </footer>

    <script>
        // æ¸¸æˆæ•°æ®
        let gameData = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let wrongAttempts = 0;
        let isAnswerSelected = false;

        // DOMå…ƒç´ 
        const uploadPage = document.getElementById('upload-page');
        const gamePage = document.getElementById('game-page');
        const resultPage = document.getElementById('result-page');
        const fileUpload = document.getElementById('file-upload');
        const fileName = document.getElementById('file-name');
        const startGameBtn = document.getElementById('start-game');
        const nextQuestionBtn = document.getElementById('next-question');
        const playAgainBtn = document.getElementById('play-again');
        const backHomeBtn = document.getElementById('back-home');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const feedback = document.getElementById('feedback');
        const feedbackText = document.getElementById('feedback-text');
        const optionCards = document.querySelectorAll('.option-card');
        const correctSound = document.getElementById('correct-sound');

        // ç¤ºä¾‹æ•°æ® - å¢åŠ æ›´å¤šæ¡ˆä»¶
        const sampleData = [
            {
                clues: ["æˆ‘ä½åœ¨æ°´é‡Œ", "æˆ‘ä¸æ˜¯é±¼", "æˆ‘æœ‰åšç¡¬çš„å¤–å£³", "æˆ‘çˆ¬çš„å¾ˆæ…¢"],
                options: ["ğŸ¢", "ğŸ™", "ğŸ³", "ğŸ•·"],
                answer: "ğŸ¢"
            },
            {
                clues: ["æˆ‘æ˜¯äº¤é€šå·¥å…·", "æˆ‘åœ¨åœ°ä¸Šè¡Œé©¶", "æˆ‘æœ‰2ä¸ªè½®", "æˆ‘ä¸éœ€è¦ç”¨ç”µ"],
                options: ["âœˆï¸", "ğŸš•", "ğŸš²", "ğŸ›µ"],
                answer: "ğŸš²"
            },
            {
                clues: ["æˆ‘å¯ä»¥åƒ", "æˆ‘æ˜¯æ°´æœ", "æˆ‘æ˜¯çº¢è‰²çš„", "æˆ‘èº«ä¸Šæœ‰å¾ˆå¤šç‚¹ç‚¹"],
                options: ["ğŸ¥•", "ğŸ“", "ğŸŒ", "ğŸ"],
                answer: "ğŸ“"
            },
            {
                clues: ["æˆ‘å¯ä»¥å‘å‡ºå£°éŸ³", "æˆ‘éœ€è¦ç”¨åˆ°å˜´å·´", "æˆ‘éœ€è¦ç”¨ç”µ", "æˆ‘ä¸èƒ½è¢«éšèº«å¸¦ç€"],
                options: ["ğŸ“·", "ğŸ§", "â˜", "ğŸ“¢"],
                answer: "â˜",
                colorIcons: true
            },
            {
                clues: ["æˆ‘æ˜¯ä¸€ç§å¤©æ°”", "æˆ‘ä¼šè®©åœ°é¢å˜ç™½", "æˆ‘åœ¨å†¬å¤©å‡ºç°", "æˆ‘å¾ˆå†°å†·"],
                options: ["â˜€ï¸", "ğŸŒ§", "â„ï¸", "âš¡"],
                answer: "â„ï¸"
            }
        ];

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            fileUpload.addEventListener('change', handleFileUpload);
            startGameBtn.addEventListener('click', startGame);
            nextQuestionBtn.addEventListener('click', loadNextQuestion);
            playAgainBtn.addEventListener('click', restartGame);
            backHomeBtn.addEventListener('click', goToHome);
            
            optionCards.forEach(card => {
                card.addEventListener('click', handleOptionSelect);
            });
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            fileName.textContent = `å·²æ¥æ”¶æ¡£æ¡ˆ: ${file.name}`;
            fileName.classList.remove('hidden');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    gameData = jsonData.map(item => {
                        const clues = item['æè¿°çº¿ç´¢'].split('ã€');
                        const options = item['ç­”æ¡ˆé€‰é¡¹'].split('ã€');
                        const answer = item['æ­£ç¡®ç­”æ¡ˆ'];
                        
                        return { clues, options, answer };
                    });
                    
                } catch (error) {
                    alert('æ¡£æ¡ˆè§£æé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameData.length === 0) {
                gameData = [...sampleData];
            }
            
            uploadPage.classList.add('hidden');
            gamePage.classList.remove('hidden');
            currentQuestionIndex = 0;
            loadQuestion(currentQuestionIndex);
            updateProgress();
        }

        // åŠ è½½é—®é¢˜
        function loadQuestion(index) {
            if (index >= gameData.length) {
                endGame();
                return;
            }
            
            const question = gameData[index];
            resetQuestionState();
            
            // åŠ è½½çº¿ç´¢
            question.clues.forEach((clue, i) => {
                document.getElementById(`clue-${i}`).textContent = clue;
            });
            
            // åŠ è½½é€‰é¡¹
            question.options.forEach((option, i) => {
                const optionImg = document.getElementById(`option-${i}-img`);
                optionImg.textContent = option;
                
                // å½©è‰²å›¾æ ‡è®¾ç½®
                if (question.colorIcons) {
                    optionImg.classList.add('color-icon');
                } else {
                    optionImg.classList.remove('color-icon');
                }
                
                document.getElementById(`option-${i}-text`).textContent = getOptionText(option);
            });
        }

        // è·å–é€‰é¡¹æ–‡æœ¬æè¿°
        function getOptionText(emoji) {
            const emojiMap = {
                "ğŸ¢": "ä¹Œé¾Ÿ",
                "ğŸ™": "ç« é±¼",
                "ğŸ³": "é²¸é±¼",
                "ğŸ•·": "èœ˜è››",
                "âœˆï¸": "é£æœº",
                "ğŸš•": "å‡ºç§Ÿè½¦",
                "ğŸš²": "è‡ªè¡Œè½¦",
                "ğŸ›µ": "ç”µåŠ¨è½¦",
                "ğŸ¥•": "èƒ¡èåœ",
                "ğŸ“": "è‰è“",
                "ğŸŒ": "é¦™è•‰",
                "ğŸ": "è‹¹æœ",
                "ğŸ“·": "ç›¸æœº",
                "ğŸ§": "è€³æœº",
                "â˜": "ç”µè¯",
                "ğŸ“¢": "å–‡å­",
                "â˜€ï¸": "å¤ªé˜³",
                "ğŸŒ§": "ä¸‹é›¨",
                "â„ï¸": "ä¸‹é›ª",
                "âš¡": "é—ªç”µ"
            };
            
            return emojiMap[emoji] || "";
        }

        // é‡ç½®é—®é¢˜çŠ¶æ€
        function resetQuestionState() {
            selectedAnswer = null;
            isAnswerSelected = false;
            wrongAttempts = 0;
            nextQuestionBtn.disabled = true;
            feedback.classList.add('hidden');
            
            optionCards.forEach(card => {
                card.classList.remove('border-green-700', 'border-red-700', 'correct-animation', 'wrong-animation', 'bg-green-100', 'bg-red-100');
                card.classList.add('border-transparent');
                card.style.pointerEvents = 'auto';
            });
        }

        // å¤„ç†é€‰é¡¹é€‰æ‹©
        function handleOptionSelect(e) {
            if (isAnswerSelected) return;
            
            const index = parseInt(this.dataset.index);
            const question = gameData[currentQuestionIndex];
            const selectedOption = question.options[index];
            
            selectedAnswer = selectedOption;
            const isCorrect = selectedOption === question.answer;
            
            if (isCorrect) {
                // æ’­æ”¾æ­£ç¡®è¯­éŸ³åé¦ˆ
                correctSound.play().catch(e => {
                    console.log("éŸ³é¢‘æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’:", e);
                });
                
                this.classList.add('border-green-700', 'bg-green-100', 'correct-animation');
                feedbackText.textContent = "å¤ªæ£’äº†ï¼Œä½ æ‰¾åˆ°çœŸç›¸äº†ï¼";
                feedbackText.className = "text-xl font-bold text-green-800 handwritten";
                nextQuestionBtn.disabled = false;
                isAnswerSelected = true;
                
                optionCards.forEach(card => {
                    card.style.pointerEvents = 'none';
                });
            } else {
                wrongAttempts++;
                this.classList.add('border-red-700', 'bg-red-100', 'wrong-animation');
                
                if (wrongAttempts >= 2) {
                    const correctIndex = question.options.indexOf(question.answer);
                    optionCards[correctIndex].classList.add('border-green-700', 'bg-green-100');
                    
                    feedbackText.textContent = "å†è¯•ä¸€æ¬¡ï¼æ­£ç¡®ç­”æ¡ˆåœ¨è¿™é‡Œ~";
                    feedbackText.className = "text-xl font-bold text-orange-700 handwritten";
                    nextQuestionBtn.disabled = false;
                    isAnswerSelected = true;
                    
                    optionCards.forEach(card => {
                        card.style.pointerEvents = 'none';
                    });
                } else {
                    feedbackText.textContent = "ä¸å¯¹å“¦ï¼Œå†çœ‹çœ‹çº¿ç´¢å§ï¼";
                    feedbackText.className = "text-xl font-bold text-red-700 handwritten";
                    this.style.pointerEvents = 'none';
                }
                
                feedback.classList.remove('hidden');
            }
        }

        // åŠ è½½ä¸‹ä¸€é¢˜
        function loadNextQuestion() {
            currentQuestionIndex++;
            loadQuestion(currentQuestionIndex);
            updateProgress();
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / gameData.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${currentQuestionIndex + 1}/${gameData.length}`;
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gamePage.classList.add('hidden');
            resultPage.classList.remove('hidden');
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            resultPage.classList.add('hidden');
            startGame();
        }

        // è¿”å›ä¸»é¡µ
        function goToHome() {
            resultPage.classList.add('hidden');
            gamePage.classList.add('hidden');
            uploadPage.classList.remove('hidden');
            fileUpload.value = '';
            fileName.classList.add('hidden');
            gameData = [];
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initEventListeners);
    </script>
</body>
</html>
    