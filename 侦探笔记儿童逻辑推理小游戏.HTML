<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>侦探笔记 - 儿童推理挑战</title>
    <!-- 引入外部资源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- 配置Tailwind自定义样式 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        detective: {
                            brown: '#8B4513',      // 牛皮纸棕色
                            sepia: '#E8C69E',     // 复古褐色
                            ink: '#2C1E1E',       // 墨水色
                            accent: '#A62639',    // 强调色（红色印章）
                            yellow: '#F9E076',    // 便签黄色
                            tape: '#FFFFFF80',    // 胶带色
                        }
                    },
                    fontFamily: {
                        detective: ['"Courier New"', '"Comic Sans MS"', 'serif']
                    }
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .paper-texture {
                background-image: url('https://picsum.photos/id/106/1000/1000');
                background-size: cover;
                background-blend-mode: overlay;
            }
            .map-texture {
                background-image: url('https://picsum.photos/id/101/1000/1000');
                background-size: cover;
                background-blend-mode: overlay;
                opacity: 0.1;
            }
            .notebook-line {
                background-image: linear-gradient(#2C1E1E10 1px, transparent 1px);
                background-size: 100% 1.75rem;
            }
            .stamp {
                transform: rotate(-10deg);
                opacity: 0.8;
            }
            .tape {
                position: relative;
            }
            .tape::before {
                content: "";
                position: absolute;
                width: 60px;
                height: 20px;
                background-color: theme('colors.detective.tape');
                transform: rotate(-15deg);
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }
            .tape-top-left::before {
                top: -10px;
                left: 10px;
            }
            .tape-top-right::before {
                top: -10px;
                right: 10px;
                transform: rotate(15deg);
            }
            .handwritten {
                text-shadow: 1px 1px 0px rgba(0,0,0,0.05);
            }
            .magnify-hover {
                transition: transform 0.3s ease;
            }
            .magnify-hover:hover {
                transform: scale(1.05);
            }
            .clue-appear {
                animation: clueAppear 0.5s ease forwards;
            }
            @keyframes clueAppear {
                from { opacity: 0; transform: translateX(-20px); }
                to { opacity: 1; transform: translateX(0); }
            }
            .correct-animation {
                animation: correct 0.5s ease;
            }
            @keyframes correct {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }
            .wrong-animation {
                animation: wrong 0.5s ease;
            }
            @keyframes wrong {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
            .page-curl {
                position: relative;
            }
            .page-curl::after {
                content: "";
                position: absolute;
                bottom: 0;
                right: 0;
                width: 30px;
                height: 30px;
                background: linear-gradient(135deg, transparent 50%, rgba(0,0,0,0.05) 50%);
                border-radius: 0 0 0 5px;
            }
        }
    </style>
</head>
<body class="bg-detective-sepia paper-texture min-h-screen font-detective text-detective-ink overflow-x-hidden">
    <!-- 地图纹理装饰层 -->
    <div class="fixed inset-0 map-texture pointer-events-none z-0"></div>

    <div class="container mx-auto px-4 py-8 relative z-10">
        <!-- 标题区域 - 侦探笔记风格 -->
        <div class="text-center mb-8 relative tape tape-top-left">
            <div class="absolute -top-4 -left-4 md:-left-10 text-4xl md:text-6xl text-detective-brown/30 rotate-12">🔍</div>
            <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-detective-brown relative inline-block handwritten">
                侦探笔记
                <div class="absolute -bottom-2 left-0 w-full h-1 bg-detective-brown/50"></div>
            </h1>
            <p class="text-[clamp(1rem,2vw,1.25rem)] text-detective-ink/80 mt-4 italic">儿童推理挑战案件簿</p>
            <div class="absolute -top-4 -right-4 md:-right-10 text-4xl md:text-6xl text-detective-brown/30 -rotate-12">📝</div>
        </div>

        <!-- 页面容器 - 笔记本风格 -->
        <div class="max-w-5xl mx-auto bg-detective-sepia/90 rounded-lg shadow-2xl border-2 border-detective-brown/30 overflow-hidden relative page-curl">
            <!-- 笔记本装订线装饰 -->
            <div class="absolute left-0 top-0 bottom-0 w-4 md:w-6 bg-detective-brown/20 flex flex-col justify-between">
                <div class="flex-1"></div>
                <div class="w-full h-full flex flex-col justify-around py-4">
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                    <div class="w-2 h-2 rounded-full bg-detective-brown/40 mx-auto"></div>
                </div>
                <div class="flex-1"></div>
            </div>

            <!-- 内容区域 - 向右偏移以避开装订线 -->
            <div class="ml-4 md:ml-6 p-4 md:p-8">
                <!-- 1. 首页/上传页面 -->
                <div id="upload-page" class="transition-all duration-500 relative">
                    <!-- 装饰性侦探元素 -->
                    <div class="absolute top-4 right-4 text-3xl opacity-20 transform rotate-12">🔍</div>
                    
                    <div class="text-center mb-8 tape tape-top-right">
                        <div class="inline-block p-4 bg-detective-yellow rounded-lg shadow-md mb-4 transform -rotate-2">
                            <i class="fa fa-search text-4xl text-detective-ink"></i>
                        </div>
                        <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-detective-brown transform rotate-1 handwritten">案件准备</h2>
                        <p class="text-detective-ink/70 mt-2 italic">选择你的案件档案，开始调查！</p>
                    </div>

                    <div class="space-y-8">
                        <!-- 文件上传区域 - 侦探档案袋风格 -->
                        <div class="border-2 border-detective-brown/40 rounded-lg p-6 md:p-8 bg-detective-sepia notebook-line shadow-md relative magnify-hover">
                            <div class="absolute top-2 right-2 text-xl opacity-30">📂</div>
                            <label for="file-upload" class="cursor-pointer">
                                <div class="mb-4 text-center">
                                    <i class="fa fa-folder-open text-5xl text-detective-brown/70"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-detective-brown mb-3 text-center handwritten">上传案件档案</h3>
                                <p class="text-detective-ink/70 mb-4 text-center">支持Excel格式的线索文件 (.xlsx, .xls)</p>
                                <div class="text-center">
                                    <span class="inline-block px-4 py-2 bg-detective-brown/10 border border-detective-brown/30 rounded text-detective-brown cursor-pointer hover:bg-detective-brown/20 transition-colors">
                                        <i class="fa fa-upload mr-1"></i> 选择文件
                                    </span>
                                </div>
                                <input id="file-upload" type="file" accept=".xlsx, .xls" class="hidden" />
                            </label>
                            <div id="file-name" class="mt-4 text-detective-accent text-center hidden"></div>
                        </div>

                        <!-- 快捷开始按钮 -->
                        <div class="bg-detective-yellow/40 p-4 rounded-lg notebook-line shadow-sm">
                            <p class="text-center text-detective-ink/80 mb-3">没有案件档案？直接开始预设案件！</p>
                            <div class="flex justify-center">
                                <button id="start-game" class="px-8 py-3 bg-detective-brown text-white font-bold rounded shadow-md hover:bg-brown-800 transition-all transform hover:-rotate-1 active:rotate-1">
                                    <i class="fa fa-play mr-2"></i>开始调查
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 装饰性元素 - 侦探笔记涂鸦 -->
                    <div class="mt-6 text-right opacity-20">
                        <i class="fa fa-pencil-square-o text-4xl"></i>
                    </div>
                </div>

                <!-- 2. 游戏界面 -->
                <div id="game-page" class="hidden transition-all duration-500">
                    <!-- 装饰性元素 -->
                    <div class="absolute top-4 right-4 text-2xl opacity-20">📋</div>
                    
                    <!-- 进度指示 - 案件进度 -->
                    <div class="mb-8 relative p-3 bg-detective-yellow/30 rounded shadow-sm notebook-line">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-detective-ink font-semibold flex items-center">
                                <i class="fa fa-list-ol mr-2"></i>案件进度
                            </span>
                            <span id="progress-text" class="text-detective-brown font-bold bg-white/50 px-2 py-0.5 rounded"></span>
                        </div>
                        <div class="h-2 bg-white/70 rounded-full overflow-hidden border border-detective-brown/30">
                            <div id="progress-bar" class="h-full bg-detective-accent rounded-full transition-all duration-500" style="width: 25%"></div>
                        </div>
                    </div>

                    <!-- 顶部选项区域 - 嫌疑人/线索选择 -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-detective-brown mb-4 pl-2 border-l-4 border-detective-brown/50 handwritten">
                            <i class="fa fa-users mr-2"></i>调查对象
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="option-card bg-white/60 rounded-lg p-3 cursor-pointer border-2 border-transparent hover:border-detective-brown shadow-md magnify-hover" data-index="0">
                                <div class="option-image h-28 md:h-36 flex items-center justify-center text-5xl md:text-7xl mb-2">
                                    <span id="option-0-img"></span>
                                </div>
                                <div class="option-text text-center font-medium text-detective-ink text-sm md:text-base" id="option-0-text"></div>
                            </div>
                            <div class="option-card bg-white/60 rounded-lg p-3 cursor-pointer border-2 border-transparent hover:border-detective-brown shadow-md magnify-hover" data-index="1">
                                <div class="option-image h-28 md:h-36 flex items-center justify-center text-5xl md:text-7xl mb-2">
                                    <span id="option-1-img"></span>
                                </div>
                                <div class="option-text text-center font-medium text-detective-ink text-sm md:text-base" id="option-1-text"></div>
                            </div>
                            <div class="option-card bg-white/60 rounded-lg p-3 cursor-pointer border-2 border-transparent hover:border-detective-brown shadow-md magnify-hover" data-index="2">
                                <div class="option-image h-28 md:h-36 flex items-center justify-center text-5xl md:text-7xl mb-2">
                                    <span id="option-2-img"></span>
                                </div>
                                <div class="option-text text-center font-medium text-detective-ink text-sm md:text-base" id="option-2-text"></div>
                            </div>
                            <div class="option-card bg-white/60 rounded-lg p-3 cursor-pointer border-2 border-transparent hover:border-detective-brown shadow-md magnify-hover" data-index="3">
                                <div class="option-image h-28 md:h-36 flex items-center justify-center text-5xl md:text-7xl mb-2">
                                    <span id="option-3-img"></span>
                                </div>
                                <div class="option-text text-center font-medium text-detective-ink text-sm md:text-base" id="option-3-text"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 中央线索区域 - 笔记风格 -->
                    <div class="bg-white/70 rounded-lg p-5 md:p-7 mb-8 shadow-md relative notebook-line border border-detective-brown/20 tape tape-top-left">
                        <!-- 红色印章装饰 -->
                        <div class="absolute top-2 right-2 text-5xl text-detective-accent/20 stamp">
                            <i class="fa fa-gavel"></i>
                        </div>
                        
                        <h3 class="text-xl font-bold text-detective-brown mb-6 flex items-center relative handwritten">
                            <i class="fa fa-file-text-o mr-2"></i>案件线索笔记
                            <div class="absolute -bottom-2 left-0 w-full h-0.5 bg-detective-brown/30"></div>
                        </h3>
                        
                        <div class="space-y-4 mt-6 pl-2">
                            <div class="clue-item clue-appear flex items-start" style="animation-delay: 0.1s">
                                <div class="bg-detective-brown text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 flex-shrink-0 mt-0.5 text-sm">1</div>
                                <p class="text-detective-ink" id="clue-0"></p>
                            </div>
                            <div class="clue-item clue-appear flex items-start" style="animation-delay: 0.2s">
                                <div class="bg-detective-brown text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 flex-shrink-0 mt-0.5 text-sm">2</div>
                                <p class="text-detective-ink" id="clue-1"></p>
                            </div>
                            <div class="clue-item clue-appear flex items-start" style="animation-delay: 0.3s">
                                <div class="bg-detective-brown text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 flex-shrink-0 mt-0.5 text-sm">3</div>
                                <p class="text-detective-ink" id="clue-2"></p>
                            </div>
                            <div class="clue-item clue-appear flex items-start" style="animation-delay: 0.4s">
                                <div class="bg-detective-brown text-white rounded-full w-6 h-6 flex items-center justify-center font-bold mr-3 flex-shrink-0 mt-0.5 text-sm">4</div>
                                <p class="text-detective-ink" id="clue-3"></p>
                            </div>
                        </div>
                    </div>

                    <!-- 底部交互区域 -->
                    <div class="flex justify-center">
                        <button id="next-question" class="px-8 py-3 bg-detective-accent text-white font-bold rounded shadow-md hover:bg-red-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed transform hover:rotate-1 active:-rotate-1">
                            <i class="fa fa-arrow-right mr-2"></i>下一个案件
                        </button>
                    </div>

                    <!-- 反馈信息 -->
                    <div id="feedback" class="mt-6 text-center hidden">
                        <p id="feedback-text" class="text-xl font-bold handwritten"></p>
                    </div>
                </div>

                <!-- 3. 结算页面 -->
                <div id="result-page" class="hidden transition-all duration-500 text-center">
                    <!-- 装饰印章 -->
                    <div class="text-8xl text-detective-accent/20 absolute top-10 right-10 stamp">
                        <i class="fa fa-trophy"></i>
                    </div>
                    
                    <div class="mb-8 relative tape tape-top-left">
                        <div class="inline-block p-5 bg-detective-yellow rounded-lg shadow-md mb-6 transform rotate-2">
                            <i class="fa fa-certificate text-5xl text-detective-ink"></i>
                        </div>
                        <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-detective-brown mb-4 transform -rotate-1 handwritten">破案成功！</h2>
                        <p class="text-detective-ink/80 text-lg max-w-2xl mx-auto italic notebook-line p-4 bg-white/50 rounded">
                            恭喜你成功破解了所有案件！你的侦探技能非常出色，
                            逻辑思维和观察力都达到了顶级侦探的水平！
                        </p>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                        <button id="play-again" class="px-6 py-3 bg-detective-brown text-white font-bold rounded shadow-md hover:bg-brown-800 transition-all transform hover:-rotate-1 active:rotate-1">
                            <i class="fa fa-refresh mr-2"></i>再破一案
                        </button>
                        <button id="back-home" class="px-6 py-3 bg-detective-yellow text-detective-ink font-bold rounded shadow-md hover:bg-yellow-300 transition-all transform hover:rotate-1 active:-rotate-1">
                            <i class="fa fa-home mr-2"></i>返回档案库
                        </button>
                    </div>

                    <!-- 装饰性签名和贴纸 -->
                    <div class="mt-10 text-right text-detective-brown/70 italic">
                        <p>—— 少年侦探社</p>
                    </div>
                    <div class="absolute bottom-6 left-6 text-4xl opacity-20 transform -rotate-15">
                        <i class="fa fa-star"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 正确反馈语音 -->
    <audio id="correct-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-kid-voice-saying-yes-2855.mp3" type="audio/mpeg">
        您的浏览器不支持音频播放
    </audio>

    <!-- 页脚 -->
    <footer class="mt-12 py-6 text-center text-detective-ink/60 text-sm relative z-10">
        <p>侦探笔记 &copy; 2023 - 儿童推理训练案件集</p>
    </footer>

    <script>
        // 游戏数据
        let gameData = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let wrongAttempts = 0;
        let isAnswerSelected = false;

        // DOM元素
        const uploadPage = document.getElementById('upload-page');
        const gamePage = document.getElementById('game-page');
        const resultPage = document.getElementById('result-page');
        const fileUpload = document.getElementById('file-upload');
        const fileName = document.getElementById('file-name');
        const startGameBtn = document.getElementById('start-game');
        const nextQuestionBtn = document.getElementById('next-question');
        const playAgainBtn = document.getElementById('play-again');
        const backHomeBtn = document.getElementById('back-home');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const feedback = document.getElementById('feedback');
        const feedbackText = document.getElementById('feedback-text');
        const optionCards = document.querySelectorAll('.option-card');
        const correctSound = document.getElementById('correct-sound');

        // 示例数据 - 增加更多案件
        const sampleData = [
            {
                clues: ["我住在水里", "我不是鱼", "我有坚硬的外壳", "我爬的很慢"],
                options: ["🐢", "🐙", "🐳", "🕷"],
                answer: "🐢"
            },
            {
                clues: ["我是交通工具", "我在地上行驶", "我有2个轮", "我不需要用电"],
                options: ["✈️", "🚕", "🚲", "🛵"],
                answer: "🚲"
            },
            {
                clues: ["我可以吃", "我是水果", "我是红色的", "我身上有很多点点"],
                options: ["🥕", "🍓", "🍌", "🍎"],
                answer: "🍓"
            },
            {
                clues: ["我可以发出声音", "我需要用到嘴巴", "我需要用电", "我不能被随身带着"],
                options: ["📷", "🎧", "☎", "📢"],
                answer: "☎",
                colorIcons: true
            },
            {
                clues: ["我是一种天气", "我会让地面变白", "我在冬天出现", "我很冰冷"],
                options: ["☀️", "🌧", "❄️", "⚡"],
                answer: "❄️"
            }
        ];

        // 初始化事件监听
        function initEventListeners() {
            fileUpload.addEventListener('change', handleFileUpload);
            startGameBtn.addEventListener('click', startGame);
            nextQuestionBtn.addEventListener('click', loadNextQuestion);
            playAgainBtn.addEventListener('click', restartGame);
            backHomeBtn.addEventListener('click', goToHome);
            
            optionCards.forEach(card => {
                card.addEventListener('click', handleOptionSelect);
            });
        }

        // 处理文件上传
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            fileName.textContent = `已接收档案: ${file.name}`;
            fileName.classList.remove('hidden');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    gameData = jsonData.map(item => {
                        const clues = item['描述线索'].split('、');
                        const options = item['答案选项'].split('、');
                        const answer = item['正确答案'];
                        
                        return { clues, options, answer };
                    });
                    
                } catch (error) {
                    alert('档案解析错误，请检查文件格式是否正确');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // 开始游戏
        function startGame() {
            if (gameData.length === 0) {
                gameData = [...sampleData];
            }
            
            uploadPage.classList.add('hidden');
            gamePage.classList.remove('hidden');
            currentQuestionIndex = 0;
            loadQuestion(currentQuestionIndex);
            updateProgress();
        }

        // 加载问题
        function loadQuestion(index) {
            if (index >= gameData.length) {
                endGame();
                return;
            }
            
            const question = gameData[index];
            resetQuestionState();
            
            // 加载线索
            question.clues.forEach((clue, i) => {
                document.getElementById(`clue-${i}`).textContent = clue;
            });
            
            // 加载选项
            question.options.forEach((option, i) => {
                const optionImg = document.getElementById(`option-${i}-img`);
                optionImg.textContent = option;
                
                // 彩色图标设置
                if (question.colorIcons) {
                    optionImg.classList.add('color-icon');
                } else {
                    optionImg.classList.remove('color-icon');
                }
                
                document.getElementById(`option-${i}-text`).textContent = getOptionText(option);
            });
        }

        // 获取选项文本描述
        function getOptionText(emoji) {
            const emojiMap = {
                "🐢": "乌龟",
                "🐙": "章鱼",
                "🐳": "鲸鱼",
                "🕷": "蜘蛛",
                "✈️": "飞机",
                "🚕": "出租车",
                "🚲": "自行车",
                "🛵": "电动车",
                "🥕": "胡萝卜",
                "🍓": "草莓",
                "🍌": "香蕉",
                "🍎": "苹果",
                "📷": "相机",
                "🎧": "耳机",
                "☎": "电话",
                "📢": "喇叭",
                "☀️": "太阳",
                "🌧": "下雨",
                "❄️": "下雪",
                "⚡": "闪电"
            };
            
            return emojiMap[emoji] || "";
        }

        // 重置问题状态
        function resetQuestionState() {
            selectedAnswer = null;
            isAnswerSelected = false;
            wrongAttempts = 0;
            nextQuestionBtn.disabled = true;
            feedback.classList.add('hidden');
            
            optionCards.forEach(card => {
                card.classList.remove('border-green-700', 'border-red-700', 'correct-animation', 'wrong-animation', 'bg-green-100', 'bg-red-100');
                card.classList.add('border-transparent');
                card.style.pointerEvents = 'auto';
            });
        }

        // 处理选项选择
        function handleOptionSelect(e) {
            if (isAnswerSelected) return;
            
            const index = parseInt(this.dataset.index);
            const question = gameData[currentQuestionIndex];
            const selectedOption = question.options[index];
            
            selectedAnswer = selectedOption;
            const isCorrect = selectedOption === question.answer;
            
            if (isCorrect) {
                // 播放正确语音反馈
                correctSound.play().catch(e => {
                    console.log("音频播放需要用户交互:", e);
                });
                
                this.classList.add('border-green-700', 'bg-green-100', 'correct-animation');
                feedbackText.textContent = "太棒了，你找到真相了！";
                feedbackText.className = "text-xl font-bold text-green-800 handwritten";
                nextQuestionBtn.disabled = false;
                isAnswerSelected = true;
                
                optionCards.forEach(card => {
                    card.style.pointerEvents = 'none';
                });
            } else {
                wrongAttempts++;
                this.classList.add('border-red-700', 'bg-red-100', 'wrong-animation');
                
                if (wrongAttempts >= 2) {
                    const correctIndex = question.options.indexOf(question.answer);
                    optionCards[correctIndex].classList.add('border-green-700', 'bg-green-100');
                    
                    feedbackText.textContent = "再试一次！正确答案在这里~";
                    feedbackText.className = "text-xl font-bold text-orange-700 handwritten";
                    nextQuestionBtn.disabled = false;
                    isAnswerSelected = true;
                    
                    optionCards.forEach(card => {
                        card.style.pointerEvents = 'none';
                    });
                } else {
                    feedbackText.textContent = "不对哦，再看看线索吧！";
                    feedbackText.className = "text-xl font-bold text-red-700 handwritten";
                    this.style.pointerEvents = 'none';
                }
                
                feedback.classList.remove('hidden');
            }
        }

        // 加载下一题
        function loadNextQuestion() {
            currentQuestionIndex++;
            loadQuestion(currentQuestionIndex);
            updateProgress();
        }

        // 更新进度
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / gameData.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${currentQuestionIndex + 1}/${gameData.length}`;
        }

        // 结束游戏
        function endGame() {
            gamePage.classList.add('hidden');
            resultPage.classList.remove('hidden');
        }

        // 重新开始游戏
        function restartGame() {
            resultPage.classList.add('hidden');
            startGame();
        }

        // 返回主页
        function goToHome() {
            resultPage.classList.add('hidden');
            gamePage.classList.add('hidden');
            uploadPage.classList.remove('hidden');
            fileUpload.value = '';
            fileName.classList.add('hidden');
            gameData = [];
        }

        // 初始化游戏
        document.addEventListener('DOMContentLoaded', initEventListeners);
    </script>
</body>
</html>
    