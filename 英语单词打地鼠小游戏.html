<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­å•è¯æ‰“åœ°é¼ å°æ¸¸æˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        body {
            background: linear-gradient(to bottom, #87CEEB 60%, #7EC850 40%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #FF6B6B;
            font-size: 2.8rem;
            text-shadow: 3px 3px 0 #FFD700;
            margin-bottom: 10px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .score-board {
            font-size: 1.5rem;
            color: #4CAF50;
            font-weight: bold;
        }
        
        .hint-container {
            background: #FFD700;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 5px 0 #FFA000;
        }
        
        .hint-text {
            font-size: 1.8rem;
            color: #333;
            font-weight: bold;
        }
        
        .game-field {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .mole-hole {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            height: 200px;
        }
        
        .mole {
            font-size: 4rem;
            margin-bottom: -20px;
            z-index: 2;
            transition: transform 0.3s;
        }
        
        .word-card {
            width: 100%;
            background: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            box-shadow: 0 5px 0 #CCC;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 3;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .word-card:hover {
            transform: scale(1.05);
            box-shadow: 0 7px 0 #AAA;
        }
        
        .hole {
            font-size: 3rem;
            position: absolute;
            bottom: 0;
            z-index: 1;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 0 #388E3C;
        }
        
        button:hover {
            background: #388E3C;
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #2E7D32;
        }
        
        button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #2E7D32;
        }
        
        button.secondary {
            background: #FF6B6B;
            box-shadow: 0 5px 0 #E53935;
        }
        
        button.secondary:hover {
            background: #E53935;
            box-shadow: 0 8px 0 #C62828;
        }
        
        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-container {
            width: 100%;
            background: #e0e0e0;
            border-radius: 20px;
            margin: 15px 0;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            height: 20px;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 20px;
            width: 0%;
            transition: width 0.5s ease;
            text-align: center;
            color: white;
            font-weight: bold;
            line-height: 20px;
            font-size: 0.8rem;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes sway {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }
        
        .error {
            animation: shake 0.5s;
            background-color: #FFEBEE !important;
            color: #E53935 !important;
        }
        
        .correct {
            animation: fadeOut 0.5s forwards;
        }
        
        .balloon {
            position: absolute;
            font-size: 2rem;
            top: 20px;
            animation: float 8s infinite ease-in-out;
        }
        
        .grass {
            position: absolute;
            bottom: 0;
            font-size: 2rem;
            animation: sway 3s infinite ease-in-out;
        }
        
        /* å¼€å§‹é¡µé¢ */
        .start-screen {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .start-title {
            color: #4CAF50;
            font-size: 2.5rem;
            margin-bottom: 30px;
        }
        
        .mode-selection {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }
        
        .mode-button {
            background: #FF9800;
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 0 #F57C00;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            min-width: 200px;
        }
        
        .mode-button:hover {
            background: #F57C00;
            transform: translateY(-5px);
            box-shadow: 0 8px 0 #E65100;
        }
        
        .mode-icon {
            font-size: 3rem;
        }
        
        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            background: #2196F3;
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            display: inline-block;
            margin: 15px 0;
            transition: all 0.3s;
            box-shadow: 0 5px 0 #1976D2;
        }
        
        .file-label:hover {
            background: #1976D2;
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #0D47A1;
        }
        
        /* ç»“ç®—é¡µé¢ */
        .result-screen {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .result-title {
            color: #4CAF50;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .wrong-words-list {
            margin: 20px 0;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            background: #F5F5F5;
            padding: 15px;
            border-radius: 10px;
        }
        
        .wrong-word {
            padding: 10px;
            border-bottom: 1px dashed #CCC;
            display: flex;
            justify-content: space-between;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-field {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .hint-text {
                font-size: 1.5rem;
            }
            
            .word-card {
                font-size: 1.2rem;
            }
            
            .mode-selection {
                flex-direction: column;
                align-items: center;
            }
        }
        
        @media (max-width: 480px) {
            .game-field {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- æ°”çƒåŠ¨ç”»å…ƒç´  -->
    <div class="balloon" style="left: 10%;">ğŸˆ</div>
    <div class="balloon" style="left: 20%; animation-delay: 1s;">ğŸˆ</div>
    <div class="balloon" style="left: 80%; animation-delay: 2s;">ğŸˆ</div>
    <div class="balloon" style="left: 90%; animation-delay: 3s;">ğŸˆ</div>
    
    <!-- è‰åŠ¨ç”»å…ƒç´  -->
    <div class="grass" style="left: 5%;">ğŸŒ¿</div>
    <div class="grass" style="left: 15%; animation-delay: 0.5s;">ğŸŒ¿</div>
    <div class="grass" style="left: 25%; animation-delay: 1s;">ğŸŒ¿</div>
    <div class="grass" style="left: 75%; animation-delay: 1.5s;">ğŸŒ¿</div>
    <div class="grass" style="left: 85%; animation-delay: 2s;">ğŸŒ¿</div>
    <div class="grass" style="left: 95%; animation-delay: 2.5s;">ğŸŒ¿</div>

    <div class="container">
        <!-- å¼€å§‹é¡µé¢ -->
        <div class="start-screen" id="start-screen">
            <h2 class="start-title">è‹±è¯­å•è¯æ‰“åœ°é¼  ğŸ¹</h2>
            <p>é€‰æ‹©æ¸¸æˆæ¨¡å¼å¼€å§‹å­¦ä¹ è‹±è¯­å•è¯å§ï¼</p>
            
            <div class="mode-selection">
                <button class="mode-button" id="upload-mode-btn">
                    <span class="mode-icon">ğŸ“¤</span>
                    <span>ä¸Šä¼ å•è¯</span>
                </button>
                <button class="mode-button" id="system-mode-btn">
                    <span class="mode-icon">ğŸ«</span>
                    <span>å¼€å§‹æŒ‘æˆ˜</span>
                </button>
            </div>
            
            <p>ä¸Šä¼ Excelæ–‡ä»¶æˆ–æŒ‘æˆ˜éšæœº10ä¸ªå°å­¦å¿…å¤‡å•è¯</p>
        </div>
        
        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-section" id="upload-section">
            <h2>ä¸Šä¼ å•è¯Excelæ–‡ä»¶</h2>
            <p>è¯·ä¸Šä¼ Excelæ–‡ä»¶ï¼Œç¬¬ä¸€åˆ—ä¸ºå•è¯ï¼Œç¬¬äºŒåˆ—ä¸ºä¸­æ–‡æ„æ€</p>
            <input type="file" id="file-input" class="file-input" accept=".xlsx,.xls">
            <label for="file-input" class="file-label">é€‰æ‹©Excelæ–‡ä»¶</label>
            <div id="file-name"></div>
            <button id="back-to-start-btn">è¿”å›å¼€å§‹é¡µé¢</button>
        </div>
        
        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div id="game-section" style="display: none;">
            <div class="game-info">
                <div class="score-board">å¾—åˆ†: <span id="score">0</span></div>
                <div class="hint-container">
                    <div class="hint-text">ä¸­æ–‡æç¤º: <span id="hint-word">è¯·é€‰æ‹©å•è¯</span></div>
                </div>
                <button id="sound-btn">ğŸ”Š æ’­æ”¾å‘éŸ³</button>
            </div>
            
            <!-- è¿›åº¦æ¡ -->
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar">0%</div>
            </div>
            
            <div class="game-field" id="game-field">
                <!-- åœ°é¼ æ´å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="controls">
                <button id="restart-btn">é‡æ–°å¼€å§‹</button>
                <button id="new-words-btn">æ¢ä¸€ç»„å•è¯</button>
                <button class="secondary" id="back-to-menu-btn">è¿”å›ä¸»èœå•</button>
            </div>
        </div>
        
        <!-- ç»“ç®—é¡µé¢ -->
        <div class="result-screen" id="result-screen">
            <h2 class="result-title">æ­å–œå®Œæˆåœ°é¼ å•è¯å¤§é—¯å…³ï¼ ğŸ‰</h2>
            <p>ä½ çš„æœ€ç»ˆå¾—åˆ†: <span id="final-score">0</span></p>
            
            <h3>é”™è¯æœ¬</h3>
            <div class="wrong-words-list" id="wrong-words-list">
                <!-- é”™è¯åˆ—è¡¨å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="controls">
                <button id="play-again-btn">å†ç©ä¸€æ¬¡</button>
                <button class="secondary" id="view-wrong-btn">æŸ¥çœ‹é”™è¯æœ¬</button>
                <button id="back-to-start-from-result">è¿”å›ä¸»èœå•</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOMå…ƒç´ 
            const startScreen = document.getElementById('start-screen');
            const uploadModeBtn = document.getElementById('upload-mode-btn');
            const systemModeBtn = document.getElementById('system-mode-btn');
            const fileInput = document.getElementById('file-input');
            const fileNameDiv = document.getElementById('file-name');
            const uploadSection = document.getElementById('upload-section');
            const gameSection = document.getElementById('game-section');
            const resultScreen = document.getElementById('result-screen');
            const gameField = document.getElementById('game-field');
            const hintWord = document.getElementById('hint-word');
            const scoreDisplay = document.getElementById('score');
            const finalScoreDisplay = document.getElementById('final-score');
            const wrongWordsList = document.getElementById('wrong-words-list');
            const soundBtn = document.getElementById('sound-btn');
            const restartBtn = document.getElementById('restart-btn');
            const newWordsBtn = document.getElementById('new-words-btn');
            const playAgainBtn = document.getElementById('play-again-btn');
            const viewWrongBtn = document.getElementById('view-wrong-btn');
            const progressBar = document.getElementById('progress-bar');
            const backToStartBtn = document.getElementById('back-to-start-btn');
            const backToMenuBtn = document.getElementById('back-to-menu-btn');
            const backToStartFromResult = document.getElementById('back-to-start-from-result');
            
            // æ¸¸æˆçŠ¶æ€å˜é‡
            let wordList = [];
            let currentWords = [];
            let currentHint = '';
            let score = 0;
            let wrongWords = [];
            let usedWordIndices = new Set();
            let isLastWord = false;
            let gameActive = false;
            let gameMode = ''; // 'upload' æˆ– 'system'
            
            // å°å­¦å¿…å¤‡å•è¯åº“
            const primarySchoolWords = [
                { english: "apple", chinese: "è‹¹æœ" },
                { english: "banana", chinese: "é¦™è•‰" },
                { english: "cat", chinese: "çŒ«" },
                { english: "dog", chinese: "ç‹—" },
                { english: "elephant", chinese: "å¤§è±¡" },
                { english: "fish", chinese: "é±¼" },
                { english: "grape", chinese: "è‘¡è„" },
                { english: "house", chinese: "æˆ¿å­" },
                { english: "ice cream", chinese: "å†°æ·‡æ·‹" },
                { english: "jump", chinese: "è·³è·ƒ" },
                { english: "kite", chinese: "é£ç­" },
                { english: "lion", chinese: "ç‹®å­" },
                { english: "monkey", chinese: "çŒ´å­" },
                { english: "nose", chinese: "é¼»å­" },
                { english: "orange", chinese: "æ©™å­" },
                { english: "panda", chinese: "ç†ŠçŒ«" },
                { english: "queen", chinese: "å¥³ç‹" },
                { english: "rabbit", chinese: "å…”å­" },
                { english: "sun", chinese: "å¤ªé˜³" },
                { english: "tiger", chinese: "è€è™" },
                { english: "umbrella", chinese: "é›¨ä¼" },
                { english: "vegetable", chinese: "è”¬èœ" },
                { english: "water", chinese: "æ°´" },
                { english: "xylophone", chinese: "æœ¨ç´" },
                { english: "yellow", chinese: "é»„è‰²" },
                { english: "zoo", chinese: "åŠ¨ç‰©å›­" },
                { english: "book", chinese: "ä¹¦" },
                { english: "pen", chinese: "é’¢ç¬”" },
                { english: "teacher", chinese: "è€å¸ˆ" },
                { english: "student", chinese: "å­¦ç”Ÿ" },
                { english: "school", chinese: "å­¦æ ¡" },
                { english: "friend", chinese: "æœ‹å‹" },
                { english: "family", chinese: "å®¶åº­" },
                { english: "mother", chinese: "å¦ˆå¦ˆ" },
                { english: "father", chinese: "çˆ¸çˆ¸" },
                { english: "sister", chinese: "å§å¦¹" },
                { english: "brother", chinese: "å…„å¼Ÿ" },
                { english: "happy", chinese: "å¼€å¿ƒ" },
                { english: "sad", chinese: "ä¼¤å¿ƒ" },
                { english: "run", chinese: "è·‘" },
                { english: "walk", chinese: "èµ°" },
                { english: "red", chinese: "çº¢è‰²" },
                { english: "blue", chinese: "è“è‰²" },
                { english: "green", chinese: "ç»¿è‰²" },
                { english: "black", chinese: "é»‘è‰²" },
                { english: "white", chinese: "ç™½è‰²" },
                { english: "one", chinese: "ä¸€" },
                { english: "two", chinese: "äºŒ" },
                { english: "three", chinese: "ä¸‰" },
                { english: "four", chinese: "å››" },
                { english: "five", chinese: "äº”" }
            ];
            
            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                // åˆ›å»º6ä¸ªåœ°é¼ æ´
                gameField.innerHTML = '';
                for (let i = 0; i < 6; i++) {
                    const moleHole = document.createElement('div');
                    moleHole.className = 'mole-hole';
                    moleHole.innerHTML = `
                        <div class="mole">ğŸ¹</div>
                        <div class="word-card" id="word-${i}">å•è¯</div>
                        <div class="hole">ğŸ•³ï¸</div>
                    `;
                    gameField.appendChild(moleHole);
                }
                
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                score = 0;
                scoreDisplay.textContent = score;
                wrongWords = [];
                usedWordIndices.clear();
                isLastWord = false;
                gameActive = true;
                
                // ç”Ÿæˆç¬¬ä¸€ç»„å•è¯
                generateNewWords();
            }
            
            // ç”Ÿæˆæ–°çš„ä¸€ç»„å•è¯
            function generateNewWords() {
                if (!gameActive) return;
                
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å•è¯éƒ½å·²ä½¿ç”¨
                if (usedWordIndices.size >= wordList.length) {
                    endGame();
                    return;
                }
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªå•è¯ä½œä¸ºæ­£ç¡®ç­”æ¡ˆ
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * wordList.length);
                } while (usedWordIndices.has(randomIndex));
                
                usedWordIndices.add(randomIndex);
                const correctWord = wordList[randomIndex];
                currentHint = correctWord.chinese;
                hintWord.textContent = currentHint;
                
                // æ›´æ–°è¿›åº¦æ¡
                updateProgressBar();
                
                // ç”Ÿæˆå¹²æ‰°é¡¹ï¼ˆä¸é‡å¤çš„å•è¯ï¼‰
                const distractors = [];
                const usedDistractorIndices = new Set([randomIndex]);
                
                while (distractors.length < 5) {
                    const randomDistractorIndex = Math.floor(Math.random() * wordList.length);
                    if (!usedDistractorIndices.has(randomDistractorIndex)) {
                        distractors.push(wordList[randomDistractorIndex]);
                        usedDistractorIndices.add(randomDistractorIndex);
                    }
                }
                
                // ç»„åˆæ­£ç¡®ç­”æ¡ˆå’Œå¹²æ‰°é¡¹
                currentWords = [correctWord, ...distractors];
                
                // éšæœºæ‰“ä¹±é¡ºåº
                shuffleArray(currentWords);
                
                // æ›´æ–°å•è¯å¡ç‰‡
                updateWordCards();
                
                // æœ—è¯»å•è¯
                speakWord(correctWord.english);
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            function updateProgressBar() {
                const progress = (usedWordIndices.size / wordList.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressBar.textContent = `${Math.round(progress)}% (${usedWordIndices.size}/${wordList.length})`;
            }
            
            // æ‰“ä¹±æ•°ç»„é¡ºåº
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
            
            // æ›´æ–°å•è¯å¡ç‰‡
            function updateWordCards() {
                const wordCards = document.querySelectorAll('.word-card');
                wordCards.forEach((card, index) => {
                    card.textContent = currentWords[index].english;
                    card.dataset.index = index;
                    
                    // ç§»é™¤ä¹‹å‰çš„åŠ¨ç”»ç±»
                    card.classList.remove('error');
                    card.classList.remove('correct');
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    card.onclick = function() {
                        handleWordClick(this, index);
                    };
                });
            }
            
            // å¤„ç†å•è¯ç‚¹å‡»
            function handleWordClick(card, index) {
                if (!gameActive) return;
                
                const selectedWord = currentWords[index];
                const correctWord = currentWords.find(word => word.chinese === currentHint);
                
                if (selectedWord.chinese === currentHint) {
                    // æ­£ç¡®ç­”æ¡ˆ
                    playSound('correct');
                    card.classList.add('correct');
                    
                    // å¢åŠ åˆ†æ•°
                    score += 10;
                    scoreDisplay.textContent = score;
                    
                    // å»¶è¿Ÿåç”Ÿæˆæ–°å•è¯
                    setTimeout(() => {
                        if (usedWordIndices.size >= wordList.length) {
                            endGame();
                        } else {
                            generateNewWords();
                        }
                    }, 500);
                } else {
                    // é”™è¯¯ç­”æ¡ˆ
                    playSound('error');
                    card.classList.add('error');
                    
                    // è®°å½•é”™è¯
                    if (!wrongWords.some(w => w.english === correctWord.english)) {
                        wrongWords.push(correctWord);
                    }
                }
            }
            
            // ç»“æŸæ¸¸æˆ
            function endGame() {
                gameActive = false;
                showResultScreen();
            }
            
            // æ’­æ”¾éŸ³æ•ˆ
            function playSound(type) {
                // åˆ›å»ºéŸ³é¢‘å…ƒç´ 
                const audio = new Audio();
                
                if (type === 'correct') {
                    // æ­£ç¡®éŸ³æ•ˆ
                    audio.src = 'data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DHCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMyXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';
                } else {
                    // é”™è¯¯éŸ³æ•ˆ
                    audio.src = 'data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVeLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DHCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';
                }
                
                audio.play().catch(e => console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥:", e));
            }
            
            // æœ—è¯»å•è¯
            function speakWord(word) {
                if ('speechSynthesis' in window) {
                    // åœæ­¢ä»»ä½•æ­£åœ¨è¿›è¡Œçš„è¯­éŸ³
                    speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.8; // ç¨æ…¢çš„è¯­é€Ÿï¼Œé€‚åˆå­¦ç”Ÿå­¦ä¹ 
                    
                    speechSynthesis.speak(utterance);
                }
            }
            
            // æ˜¾ç¤ºç»“ç®—é¡µé¢
            function showResultScreen() {
                // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
                playVictorySound();
                
                gameSection.style.display = 'none';
                resultScreen.style.display = 'block';
                finalScoreDisplay.textContent = score;
                
                // æ˜¾ç¤ºé”™è¯æœ¬
                updateWrongWordsList();
            }
            
            // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
            function playVictorySound() {
                try {
                    const victorySound = new Audio();
                    victorySound.src = 'data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DHCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';
                    victorySound.play();
                } catch (e) {
                    console.log("èƒœåˆ©éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", e);
                }
            }
            
            // æ›´æ–°é”™è¯æœ¬
            function updateWrongWordsList() {
                wrongWordsList.innerHTML = '';
                
                if (wrongWords.length === 0) {
                    wrongWordsList.innerHTML = '<p>æ²¡æœ‰é”™è¯ï¼Œå¤ªæ£’äº†ï¼</p>';
                    return;
                }
                
                wrongWords.forEach(word => {
                    const wordElement = document.createElement('div');
                    wordElement.className = 'wrong-word';
                    wordElement.innerHTML = `
                        <span>${word.english}</span>
                        <span>${word.chinese}</span>
                    `;
                    wrongWordsList.appendChild(wordElement);
                });
            }
            
            // ä»å•è¯åº“ä¸­éšæœºé€‰æ‹©10ä¸ªå•è¯
            function selectRandomWords(count) {
                const shuffled = [...primarySchoolWords].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }
            
            // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                fileNameDiv.textContent = `å·²é€‰æ‹©: ${file.name}`;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    
                    // è½¬æ¢ä¸ºJSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: ['english', 'chinese'] });
                    
                    // ç§»é™¤æ ‡é¢˜è¡Œï¼ˆå¦‚æœæœ‰ï¼‰
                    wordList = jsonData.filter(item => 
                        item.english && item.chinese && 
                        item.english !== 'english' && 
                        item.chinese !== 'chinese'
                    );
                    
                    if (wordList.length > 0) {
                        // æ˜¾ç¤ºæ¸¸æˆåŒºåŸŸ
                        uploadSection.style.display = 'none';
                        gameSection.style.display = 'block';
                        
                        // å¯ç”¨æŒ‰é’®
                        soundBtn.disabled = false;
                        restartBtn.disabled = false;
                        newWordsBtn.disabled = false;
                        
                        // åˆå§‹åŒ–æ¸¸æˆ
                        initGame();
                    } else {
                        alert('æœªèƒ½ä»Excelä¸­æå–åˆ°å•è¯æ•°æ®ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼');
                    }
                };
                reader.readAsArrayBuffer(file);
            });
            
            // ä¸Šä¼ æ¨¡å¼æŒ‰é’®
            uploadModeBtn.addEventListener('click', function() {
                gameMode = 'upload';
                startScreen.style.display = 'none';
                uploadSection.style.display = 'block';
            });
            
            // ç³»ç»Ÿæ¨¡å¼æŒ‰é’® - ä¿®æ”¹ä¸ºé€‰æ‹©10ä¸ªéšæœºå•è¯
            systemModeBtn.addEventListener('click', function() {
                gameMode = 'system';
                startScreen.style.display = 'none';
                wordList = selectRandomWords(10);
                gameSection.style.display = 'block';
                
                // å¯ç”¨æŒ‰é’®
                soundBtn.disabled = false;
                restartBtn.disabled = false;
                newWordsBtn.disabled = false;
                
                // åˆå§‹åŒ–æ¸¸æˆ
                initGame();
            });
            
            // è¿”å›å¼€å§‹é¡µé¢æŒ‰é’®
            backToStartBtn.addEventListener('click', function() {
                uploadSection.style.display = 'none';
                startScreen.style.display = 'block';
            });
            
            // è¿”å›ä¸»èœå•æŒ‰é’®ï¼ˆä»æ¸¸æˆåŒºåŸŸï¼‰
            backToMenuBtn.addEventListener('click', function() {
                gameSection.style.display = 'none';
                startScreen.style.display = 'block';
            });
            
            // è¿”å›ä¸»èœå•æŒ‰é’®ï¼ˆä»ç»“ç®—é¡µé¢ï¼‰
            backToStartFromResult.addEventListener('click', function() {
                resultScreen.style.display = 'none';
                startScreen.style.display = 'block';
            });
            
            // æ’­æ”¾å‘éŸ³æŒ‰é’®
            soundBtn.addEventListener('click', function() {
                const correctWord = currentWords.find(word => word.chinese === currentHint);
                if (correctWord) {
                    speakWord(correctWord.english);
                }
            });
            
            // é‡æ–°å¼€å§‹æŒ‰é’®
            restartBtn.addEventListener('click', function() {
                if (gameMode === 'system') {
                    // é‡æ–°é€‰æ‹©10ä¸ªéšæœºå•è¯
                    wordList = selectRandomWords(10);
                }
                initGame();
            });
            
            // æ¢ä¸€ç»„å•è¯æŒ‰é’® - ä¿®æ”¹ä¸ºé‡æ–°é€‰æ‹©10ä¸ªå•è¯
            newWordsBtn.addEventListener('click', function() {
                if (gameMode === 'system') {
                    // é‡æ–°é€‰æ‹©10ä¸ªéšæœºå•è¯
                    wordList = selectRandomWords(10);
                }
                initGame();
            });
            
            // å†ç©ä¸€æ¬¡æŒ‰é’®
            playAgainBtn.addEventListener('click', function() {
                resultScreen.style.display = 'none';
                if (gameMode === 'upload') {
                    uploadSection.style.display = 'block';
                } else {
                    // é‡æ–°é€‰æ‹©10ä¸ªéšæœºå•è¯
                    wordList = selectRandomWords(10);
                    gameSection.style.display = 'block';
                    initGame();
                }
            });
            
            // æŸ¥çœ‹é”™è¯æœ¬æŒ‰é’®
            viewWrongBtn.addEventListener('click', updateWrongWordsList);
            
            // åˆå§‹åŒ–è§£é”æŒ‰é’®çŠ¶æ€
            soundBtn.disabled = true;
            restartBtn.disabled = true;
            newWordsBtn.disabled = true;
        });
    </script>
</body>
</html>