<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯æ³¡æ³¡æ¶ˆæ¶ˆä¹ - å°å­¦ç”Ÿå•è¯è®°å¿†æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffccd5 0%, #ffd6ff 25%, #c9f5ff 50%, #baf8c8 100%);
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            text-align: center;
            z-index: 10;
        }
        
        h1 {
            color: #ff6b6b;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0px #ffd166, 0px 0px 10px rgba(255, 255, 255, 0.8);
            font-size: 3.5rem;
            letter-spacing: 2px;
        }
        
        .mode-selection {
            background: rgba(255, 255, 255, 0.85);
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
            margin-bottom: 30px;
            border: 5px solid #ffd166;
        }
        
        .mode-buttons {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 25px 0;
        }
        
        .mode-btn {
            background: linear-gradient(to bottom, #ff9e9e, #ff6b6b);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 15px rgba(255, 107, 107, 0.4);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .mode-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 20px rgba(255, 107, 107, 0.5);
        }
        
        .mode-btn.active {
            background: linear-gradient(to bottom, #ff7b7b, #ff4c4c);
            box-shadow: 0 8px 15px rgba(255, 76, 76, 0.6);
        }
        
        .upload-section, .word-count-section {
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            border: 3px dashed #74c0fc;
        }
        
        .file-input {
            margin: 15px 0;
            padding: 12px;
            width: 100%;
            border: 2px dashed #74c0fc;
            border-radius: 15px;
            background: #f1f8fe;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .file-input:hover {
            background: #e6f4ff;
            border-color: #339af0;
        }
        
        .slider-container {
            margin: 25px 0;
            padding: 0 20px;
        }
        
        .slider {
            width: 100%;
            height: 20px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #ff9e9e, #74c0fc);
            outline: none;
            border-radius: 15px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 3px solid white;
        }
        
        .slider-value {
            font-weight: bold;
            color: #ff6b6b;
            font-size: 1.4rem;
            margin-top: 15px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .btn {
            background: linear-gradient(to bottom, #74c0fc, #339af0);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 15px rgba(51, 154, 240, 0.4);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 20px rgba(51, 154, 240, 0.5);
        }
        
        .game-area {
            position: relative;
            width: 100%;
            height: 600px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            margin-bottom: 25px;
            display: none;
            border: 5px solid #ffd166;
        }
        
        .bubble {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            font-weight: bold;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2), 
                        inset 0 -8px 15px rgba(0, 0, 0, 0.1),
                        inset 0 8px 15px rgba(255, 255, 255, 0.5);
            transition: transform 0.3s, opacity 0.5s, box-shadow 0.3s;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            padding: 10px;
            word-break: break-word;
            text-align: center;
            z-index: 2;
        }
        
        .bubble:hover {
            transform: scale(1.08);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25), 
                        inset 0 -8px 15px rgba(0, 0, 0, 0.1),
                        inset 0 8px 15px rgba(255, 255, 255, 0.5);
        }
        
        .bubble.selected {
            box-shadow: 0 0 20px 8px #ffd166, 
                        0 8px 15px rgba(0, 0, 0, 0.2), 
                        inset 0 -8px 15px rgba(0, 0, 0, 0.1),
                        inset 0 8px 15px rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }
        
        .bubble.matched {
            animation: bubbleDisappear 0.8s forwards;
            pointer-events: none;
        }
        
        @keyframes bubbleDisappear {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(0);
                opacity: 0;
                visibility: hidden;
            }
        }
        
        .result-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
            display: none;
            border: 5px solid #ffd166;
        }
        
        .result-section h2 {
            color: #4caf50;
            margin-bottom: 25px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 0px #c8e6c9;
        }
        
        .wrong-words {
            margin: 25px 0;
            text-align: left;
            max-height: 250px;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 15px;
            border: 3px solid #ffd166;
        }
        
        .wrong-word-item {
            padding: 10px;
            border-bottom: 2px dashed #ffd166;
            font-size: 1.1rem;
        }
        
        .background-bubbles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .bg-bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.8);
            animation: float 15s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
            }
            25% {
                transform: translateY(-25px) translateX(15px);
            }
            50% {
                transform: translateY(-40px) translateX(-20px);
            }
            75% {
                transform: translateY(-20px) translateX(10px);
            }
        }
        
        .instructions {
            margin-top: 15px;
            color: #666;
            font-size: 1rem;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin: 15px;
            font-weight: bold;
            color: #ff6b6b;
            font-size: 1.2rem;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            border: 3px solid #ffd166;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            color: #74c0fc;
            text-shadow: 2px 2px 0px white;
        }
        
        .match-effect {
            position: absolute;
            width: 100px;
            height: 100px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffd166"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>') no-repeat center center;
            background-size: contain;
            animation: matchEffect 1s forwards;
            z-index: 4;
            pointer-events: none;
        }
        
        @keyframes matchEffect {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.5);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 0;
            }
        }
        
        .pop-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            pointer-events: none;
            z-index: 3;
            animation: pop 0.6s forwards;
        }
        
        @keyframes pop {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="background-bubbles" id="backgroundBubbles"></div>
    
    <div class="container">
        <h1>âœ¨ å•è¯æ³¡æ³¡æ¶ˆæ¶ˆä¹ âœ¨</h1>
        
        <div class="mode-selection" id="modeSelection">
            <h2>è¯·é€‰æ‹©æ¸¸æˆæ¨¡å¼</h2>
            <div class="mode-buttons">
                <button class="mode-btn active" data-mode="upload">ä¸Šä¼ å•è¯æ–‡ä»¶</button>
                <button class="mode-btn" data-mode="system">ç³»ç»Ÿå•è¯åŒ¹é…</button>
            </div>
            
            <div class="upload-section" id="uploadSection">
                <p>è¯·ä¸Šä¼ æ ¼å¼ä¸º"è‹±æ–‡å•è¯ ä¸­æ–‡é‡Šä¹‰"çš„æ–‡æœ¬æ–‡ä»¶</p>
                <input type="file" id="fileInput" class="file-input" accept=".txt">
                <p class="instructions">ç¤ºä¾‹: apple è‹¹æœ\nbanana é¦™è•‰\ncat çŒ«</p>
            </div>
            
            <div class="word-count-section" id="wordCountSection">
                <h3>é€‰æ‹©å•è¯æ•°é‡</h3>
                <div class="slider-container">
                    <input type="range" min="5" max="20" value="10" class="slider" id="wordCountSlider">
                    <div class="slider-value">å•è¯æ•°é‡: <span id="wordCountValue">10</span></div>
                </div>
            </div>
            
            <button class="btn" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
        </div>
        
        <div class="game-area" id="gameArea">
            <div class="game-info">
                <div>å‰©ä½™é…å¯¹: <span id="pairsLeft">0</span></div>
                <div>å·²åŒ¹é…: <span id="pairsMatched">0</span></div>
            </div>
            <div class="loading" id="loadingText">æ­£åœ¨ç”Ÿæˆæ³¡æ³¡...</div>
        </div>
        
        <div class="result-section" id="resultSection">
            <h2>ğŸ‰ æ­å–œå®Œæˆæ‰€æœ‰æ³¡æ³¡æ¶ˆé™¤ï¼ ğŸ‰</h2>
            <p>ä½ çœŸæ£’ï¼æ‰€æœ‰å•è¯éƒ½åŒ¹é…æˆåŠŸäº†ï¼</p>
            
            <h3>ğŸ“ é”™è¯æœ¬</h3>
            <div class="wrong-words" id="wrongWordsList">
                <!-- é”™è¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            
            <button class="btn" id="playAgainBtn">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€å˜é‡
        let wordPairs = [];
        let bubbles = [];
        let selectedBubble = null;
        let wrongWords = [];
        let gameMode = 'upload';
        let wordCount = 10;
        let totalPairs = 0;
        let matchedPairs = 0;
        
        // å†…ç½®å°å­¦è‹±è¯­å•è¯åº“
        const elementaryWords = [
            { english: "apple", chinese: "è‹¹æœ" },
            { english: "banana", chinese: "é¦™è•‰" },
            { english: "cat", chinese: "çŒ«" },
            { english: "dog", chinese: "ç‹—" },
            { english: "elephant", chinese: "å¤§è±¡" },
            { english: "fish", chinese: "é±¼" },
            { english: "grape", chinese: "è‘¡è„" },
            { english: "house", chinese: "æˆ¿å­" },
            { english: "ice", chinese: "å†°" },
            { english: "juice", chinese: "æœæ±" },
            { english: "kite", chinese: "é£ç­" },
            { english: "lemon", chinese: "æŸ æª¬" },
            { english: "monkey", chinese: "çŒ´å­" },
            { english: "nose", chinese: "é¼»å­" },
            { english: "orange", chinese: "æ©™å­" },
            { english: "pencil", chinese: "é“…ç¬”" },
            { english: "queen", chinese: "å¥³ç‹" },
            { english: "rabbit", chinese: "å…”å­" },
            { english: "sun", chinese: "å¤ªé˜³" },
            { english: "tiger", chinese: "è€è™" },
            { english: "umbrella", chinese: "é›¨ä¼" },
            { english: "vegetable", chinese: "è”¬èœ" },
            { english: "water", chinese: "æ°´" },
            { english: "xylophone", chinese: "æœ¨ç´" },
            { english: "yellow", chinese: "é»„è‰²" },
            { english: "zoo", chinese: "åŠ¨ç‰©å›­" }
        ];
        
        // DOMå…ƒç´ 
        const modeSelection = document.getElementById('modeSelection');
        const modeButtons = document.querySelectorAll('.mode-btn');
        const uploadSection = document.getElementById('uploadSection');
        const wordCountSection = document.getElementById('wordCountSection');
        const fileInput = document.getElementById('fileInput');
        const wordCountSlider = document.getElementById('wordCountSlider');
        const wordCountValue = document.getElementById('wordCountValue');
        const startBtn = document.getElementById('startBtn');
        const gameArea = document.getElementById('gameArea');
        const loadingText = document.getElementById('loadingText');
        const resultSection = document.getElementById('resultSection');
        const wrongWordsList = document.getElementById('wrongWordsList');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const backgroundBubbles = document.getElementById('backgroundBubbles');
        let pairsLeftElement = document.getElementById('pairsLeft');
        let pairsMatchedElement = document.getElementById('pairsMatched');
        
        // åˆ›å»ºèƒŒæ™¯æ³¡æ³¡
        function createBackgroundBubbles() {
            for (let i = 0; i < 25; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bg-bubble';
                
                const size = Math.random() * 80 + 30;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                
                // éšæœºä½ç½®
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.top = `${Math.random() * 100}%`;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿå’ŒæŒç»­æ—¶é—´
                bubble.style.animationDelay = `${Math.random() * 15}s`;
                bubble.style.animationDuration = `${20 + Math.random() * 20}s`;
                
                backgroundBubbles.appendChild(bubble);
            }
        }
        
        // è§£æä¸Šä¼ çš„æ–‡ä»¶
        function parseFile(content) {
            const lines = content.split('\n');
            const pairs = [];
            
            lines.forEach(line => {
                line = line.trim();
                if (line) {
                    // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²è‹±æ–‡å’Œä¸­æ–‡
                    const match = line.match(/([a-zA-Z\s]+)\s+([\u4e00-\u9fa5]+)/);
                    if (match && match.length >= 3) {
                        pairs.push({ english: match[1].trim(), chinese: match[2].trim() });
                    }
                }
            });
            
            return pairs;
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameMode === 'upload') {
                if (wordPairs.length === 0) {
                    alert('è¯·å…ˆä¸Šä¼ æœ‰æ•ˆçš„å•è¯æ–‡ä»¶ï¼');
                    return;
                }
                // ä¸Šä¼ æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ä¸Šä¼ çš„å•è¯ï¼Œä½†é™åˆ¶æ•°é‡
                if (wordPairs.length > wordCount) {
                    wordPairs = wordPairs.slice(0, wordCount);
                }
            } else {
                // ç³»ç»Ÿæ¨¡å¼ï¼Œä»å†…ç½®å•è¯åº“ä¸­éšæœºé€‰æ‹©
                wordPairs = [];
                const shuffled = [...elementaryWords].sort(() => 0.5 - Math.random());
                const count = Math.min(wordCount, shuffled.length);
                for (let i = 0; i < count; i++) {
                    wordPairs.push(shuffled[i]);
                }
            }
            
            modeSelection.style.display = 'none';
            gameArea.style.display = 'block';
            loadingText.style.display = 'block';
            
            bubbles = [];
            selectedBubble = null;
            wrongWords = [];
            totalPairs = wordPairs.length;
            matchedPairs = 0;
            
            // é‡æ–°è·å–DOMå…ƒç´ å¼•ç”¨
            pairsLeftElement = document.getElementById('pairsLeft');
            pairsMatchedElement = document.getElementById('pairsMatched');
            
            updatePairsInfo();
            
            // ä½¿ç”¨setTimeoutè®©UIæœ‰æœºä¼šæ›´æ–°æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            setTimeout(() => {
                createBubbles();
                loadingText.style.display = 'none';
            }, 100);
        }
        
        // åˆ›å»ºå•è¯æ³¡æ³¡
        function createBubbles() {
            const allWords = [];
            
            // æ·»åŠ è‹±æ–‡å’Œä¸­æ–‡
            wordPairs.forEach(pair => {
                allWords.push({ text: pair.english, type: 'english', pair: pair.chinese });
                allWords.push({ text: pair.chinese, type: 'chinese', pair: pair.english });
            });
            
            // éšæœºæ’åº
            shuffleArray(allWords);
            
            // åˆ›å»ºæ³¡æ³¡å…ƒç´ 
            allWords.forEach((word, index) => {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.textContent = word.text;
                bubble.dataset.type = word.type;
                bubble.dataset.pair = word.pair;
                bubble.dataset.id = `${word.type}-${index}`;
                
                // éšæœºå¤§å° (70px - 130px)
                const size = Math.random() * 60 + 70;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                
                // éšæœºé¢œè‰² - ç³–æœè‰²
                const colors = [
                    '#ff9e9e', '#ffd166', '#96e6b3', '#74c0fc', 
                    '#ffa94d', '#da77f2', '#3bc9db', '#ff8787'
                ];
                const color = colors[Math.floor(Math.random() * colors.length)];
                bubble.style.background = color;
                bubble.style.color = '#333';
                bubble.style.fontSize = `${Math.max(16, 24 - word.text.length * 0.8)}px`;
                
                // è®¡ç®—ä½ç½® - ä¸è§„åˆ™åˆ†å¸ƒ
                let x, y;
                let overlapping = true;
                let attempts = 0;
                
                while (overlapping && attempts < 50) {
                    x = Math.random() * (gameArea.offsetWidth - size - 40) + 20;
                    y = Math.random() * (gameArea.offsetHeight - size - 80) + 60;
                    
                    // å¯¹äºè¶…è¿‡8ç»„çš„å•è¯ï¼Œå…è®¸éƒ¨åˆ†é‡å 
                    overlapping = isOverlapping({x, y}, size, allWords.length > 16);
                    attempts++;
                }
                
                // æ·»åŠ éšæœºåç§»å’Œæ—‹è½¬
                const rotate = Math.random() * 10 - 5;
                bubble.style.transform = `rotate(${rotate}deg)`;
                
                bubble.style.left = `${x}px`;
                bubble.style.top = `${y}px`;
                
                // æ·»åŠ 3Dæ•ˆæœ
                applyBubbleEffect(bubble);
                
                // ç‚¹å‡»äº‹ä»¶
                bubble.addEventListener('click', handleBubbleClick);
                
                gameArea.appendChild(bubble);
                bubbles.push(bubble);
            });
        }
        
        // æ£€æŸ¥æ³¡æ³¡æ˜¯å¦é‡å 
        function isOverlapping(position, size, allowOverlap) {
            for (const bubble of bubbles) {
                const rect = bubble.getBoundingClientRect();
                const bubbleCenter = {
                    x: parseFloat(bubble.style.left) + rect.width/2,
                    y: parseFloat(bubble.style.top) + rect.height/2
                };
                
                const newCenter = {
                    x: position.x + size/2,
                    y: position.y + size/2
                };
                
                const distance = Math.sqrt(
                    Math.pow(bubbleCenter.x - newCenter.x, 2) + 
                    Math.pow(bubbleCenter.y - newCenter.y, 2)
                );
                
                // å¦‚æœå…è®¸é‡å ï¼Œå‡å°‘é—´è·è¦æ±‚
                const minDistance = allowOverlap ? (rect.width/2 + size/2) * 0.8 : (rect.width/2 + size/2) * 1.2;
                
                if (distance < minDistance) {
                    return true;
                }
            }
            
            return false;
        }
        
        // åº”ç”¨3Dæ³¡æ³¡æ•ˆæœ
        function applyBubbleEffect(bubble) {
            // æ·»åŠ 3Dç«‹ä½“æ•ˆæœ
            bubble.style.background = `radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.2) 60%), ${bubble.style.background}`;
        }
        
        // å¤„ç†æ³¡æ³¡ç‚¹å‡»
        function handleBubbleClick(event) {
            const bubble = event.target;
            
            // å¦‚æœæ³¡æ³¡æ­£åœ¨æ¶ˆå¤±åŠ¨ç”»ä¸­ï¼Œå¿½ç•¥ç‚¹å‡»
            if (bubble.classList.contains('matched')) return;
            
            // æ’­æ”¾æ³¡æ³¡éŸ³æ•ˆ
            playBubbleSound();
            
            // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„æ³¡æ³¡ï¼Œé€‰ä¸­å½“å‰æ³¡æ³¡
            if (!selectedBubble) {
                bubble.classList.add('selected');
                selectedBubble = bubble;
                return;
            }
            
            // å¦‚æœç‚¹å‡»çš„æ˜¯å·²é€‰ä¸­çš„æ³¡æ³¡ï¼Œå–æ¶ˆé€‰ä¸­
            if (selectedBubble === bubble) {
                bubble.classList.remove('selected');
                selectedBubble = null;
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…
            const isMatch = 
                (selectedBubble.dataset.type === 'english' && bubble.dataset.type === 'chinese' && 
                 selectedBubble.dataset.pair === bubble.textContent) ||
                (selectedBubble.dataset.type === 'chinese' && bubble.dataset.type === 'english' && 
                 selectedBubble.textContent === bubble.dataset.pair);
            
            if (isMatch) {
                // åŒ¹é…æˆåŠŸ
                playWordPronunciation(selectedBubble.dataset.type === 'english' ? 
                    selectedBubble.textContent : bubble.textContent);
                
                // åˆ›å»ºåŒ¹é…æˆåŠŸæ•ˆæœ
                createMatchEffect(selectedBubble, bubble);
                
                // æ ‡è®°æ³¡æ³¡ä¸ºå·²åŒ¹é…ï¼Œå¯åŠ¨æ¶ˆå¤±åŠ¨ç”»
                selectedBubble.classList.add('matched');
                bubble.classList.add('matched');
                
                // åˆ›å»ºæ³¡æ³¡ç ´è£‚æ•ˆæœ
                createPopEffect(selectedBubble);
                createPopEffect(bubble);
                
                // æ›´æ–°åŒ¹é…è®¡æ•°
                matchedPairs++;
                updatePairsInfo();
                
                // å®Œå…¨ç§»é™¤æ³¡æ³¡
                setTimeout(() => {
                    if (selectedBubble.parentNode) {
                        gameArea.removeChild(selectedBubble);
                    }
                    if (bubble.parentNode) {
                        gameArea.removeChild(bubble);
                    }
                    
                    // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                    checkGameEnd();
                }, 800); // ä¸CSSåŠ¨ç”»æ—¶é—´åŒ¹é…
            } else {
                // ä¸åŒ¹é…ï¼Œæ·»åŠ åˆ°é”™è¯æœ¬
                if (selectedBubble.dataset.type === 'english') {
                    wrongWords.push({
                        english: selectedBubble.textContent,
                        chinese: selectedBubble.dataset.pair
                    });
                } else {
                    wrongWords.push({
                        english: bubble.dataset.pair,
                        chinese: bubble.textContent
                    });
                }
                
                // æ˜¾ç¤ºä¸åŒ¹é…æ•ˆæœ
                selectedBubble.classList.add('selected');
                bubble.classList.add('selected');
                
                setTimeout(() => {
                    selectedBubble.classList.remove('selected');
                    bubble.classList.remove('selected');
                }, 1000);
            }
            
            selectedBubble = null;
        }
        
        // åˆ›å»ºåŒ¹é…æˆåŠŸæ•ˆæœ
        function createMatchEffect(bubble1, bubble2) {
            const rect1 = bubble1.getBoundingClientRect();
            const rect2 = bubble2.getBoundingClientRect();
            
            const centerX = (rect1.left + rect1.width/2 + rect2.left + rect2.width/2) / 2;
            const centerY = (rect1.top + rect1.height/2 + rect2.top + rect2.height/2) / 2;
            
            const effect = document.createElement('div');
            effect.className = 'match-effect';
            effect.style.left = `${centerX - 50}px`;
            effect.style.top = `${centerY - 50}px`;
            
            gameArea.appendChild(effect);
            
            setTimeout(() => {
                if (effect.parentNode) {
                    gameArea.removeChild(effect);
                }
            }, 1000);
        }
        
        // åˆ›å»ºæ³¡æ³¡ç ´è£‚æ•ˆæœ
        function createPopEffect(bubble) {
            const rect = bubble.getBoundingClientRect();
            const pop = document.createElement('div');
            pop.className = 'pop-effect';
            pop.style.width = `${rect.width}px`;
            pop.style.height = `${rect.height}px`;
            pop.style.left = bubble.style.left;
            pop.style.top = bubble.style.top;
            pop.style.background = bubble.style.background;
            
            gameArea.appendChild(pop);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                if (pop.parentNode) {
                    gameArea.removeChild(pop);
                }
            }, 600);
        }
        
        // æ›´æ–°é…å¯¹ä¿¡æ¯
        function updatePairsInfo() {
            pairsLeftElement.textContent = totalPairs - matchedPairs;
            pairsMatchedElement.textContent = matchedPairs;
        }
        
        // æ’­æ”¾æ³¡æ³¡éŸ³æ•ˆ
        function playBubbleSound() {
            try {
                // åˆ›å»ºæ›´é€¼çœŸçš„æ³¡æ³¡éŸ³æ•ˆ
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e);
            }
        }
        
        // æ’­æ”¾å•è¯å‘éŸ³
        function playWordPronunciation(word) {
            // ä½¿ç”¨æµè§ˆå™¨è¯­éŸ³åˆæˆAPI
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }
        
        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
        function checkGameEnd() {
            if (gameArea.querySelectorAll('.bubble').length === 0) {
                showResult();
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult() {
            resultSection.style.display = 'block';
            gameArea.style.display = 'none';
            
            // æ˜¾ç¤ºé”™è¯
            wrongWordsList.innerHTML = '';
            if (wrongWords.length === 0) {
                wrongWordsList.innerHTML = '<p class="wrong-word-item">æ²¡æœ‰é”™è¯ï¼å¤ªæ£’äº†ï¼âœ¨</p>';
            } else {
                // å»é‡
                const uniqueWrongWords = [];
                const addedWords = new Set();
                
                wrongWords.forEach(word => {
                    const key = `${word.english}-${word.chinese}`;
                    if (!addedWords.has(key)) {
                        uniqueWrongWords.push(word);
                        addedWords.add(key);
                    }
                });
                
                uniqueWrongWords.forEach(word => {
                    const wordEl = document.createElement('p');
                    wordEl.className = 'wrong-word-item';
                    wordEl.textContent = `${word.english} - ${word.chinese}`;
                    wrongWordsList.appendChild(wordEl);
                });
            }
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            resultSection.style.display = 'none';
            modeSelection.style.display = 'block';
            gameArea.style.display = 'none';
            wrongWords = [];
            wordPairs = [];
        }
        
        // æ•°ç»„éšæœºæ’åº
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // åˆå§‹åŒ–
        function init() {
            createBackgroundBubbles();
            
            // æ¨¡å¼é€‰æ‹©äº‹ä»¶
            modeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    modeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    gameMode = this.dataset.mode;
                    
                    // ä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤ºå•è¯æ•°é‡æ»‘å—
                    wordCountSection.style.display = 'block';
                    
                    if (gameMode === 'upload') {
                        uploadSection.style.display = 'block';
                    } else {
                        uploadSection.style.display = 'none';
                    }
                });
            });
            
            // å•è¯æ•°é‡æ»‘å—äº‹ä»¶
            wordCountSlider.addEventListener('input', function() {
                wordCount = parseInt(this.value);
                wordCountValue.textContent = wordCount;
            });
            
            // æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    const parsedPairs = parseFile(content);
                    
                    if (parsedPairs.length > 0) {
                        wordPairs = parsedPairs;
                        // æ›´æ–°æ»‘å—æœ€å¤§å€¼
                        wordCountSlider.max = Math.max(wordPairs.length, 20);
                        wordCountSlider.value = Math.min(wordCount, wordPairs.length);
                        wordCount = parseInt(wordCountSlider.value);
                        wordCountValue.textContent = wordCount;
                        
                        alert(`æˆåŠŸåŠ è½½ ${wordPairs.length} ä¸ªå•è¯å¯¹ï¼`);
                    } else {
                        alert('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„å•è¯å¯¹ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼');
                    }
                };
                reader.readAsText(file);
            });
            
            // å¼€å§‹æ¸¸æˆæŒ‰é’®
            startBtn.addEventListener('click', startGame);
            
            // å†ç©ä¸€æ¬¡æŒ‰é’®
            playAgainBtn.addEventListener('click', restartGame);
            
            // é»˜è®¤æ˜¾ç¤ºä¸Šä¼ åŒºåŸŸå’Œå•è¯æ•°é‡æ»‘å—
            uploadSection.style.display = 'block';
            wordCountSection.style.display = 'block';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>